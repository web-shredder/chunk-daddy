@tailwind base;
@tailwind components;
@tailwind utilities;

/* Moonbug Design System - Linear-inspired dark theme */

@layer base {
  :root {
    /* Moonbug Light Mode (fallback) */
    --background: 0 0% 4%;
    --foreground: 0 0% 98%;

    --card: 0 0% 8%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 11%;
    --popover-foreground: 0 0% 98%;

    --primary: 72 100% 55%;
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 11%;
    --secondary-foreground: 0 0% 98%;

    --muted: 0 0% 15%;
    --muted-foreground: 0 0% 64%;

    --accent: 72 100% 55%;
    --accent-foreground: 0 0% 0%;

    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 98%;

    --success: 142 76% 36%;
    --success-foreground: 0 0% 98%;

    --warning: 45 93% 47%;
    --warning-foreground: 0 0% 0%;

    --border: 0 0% 18%;
    --border-hover: 0 0% 24%;
    --border-active: 72 100% 55%;
    --input: 0 0% 18%;
    --ring: 72 100% 55%;

    --radius: 0.375rem;

    /* Sidebar */
    --sidebar-background: 0 0% 6%;
    --sidebar-foreground: 0 0% 98%;
    --sidebar-primary: 72 100% 55%;
    --sidebar-primary-foreground: 0 0% 0%;
    --sidebar-accent: 0 0% 12%;
    --sidebar-accent-foreground: 0 0% 98%;
    --sidebar-border: 0 0% 18%;
    --sidebar-ring: 72 100% 55%;

    /* Surface layers */
    --surface: 0 0% 8%;
    --elevated: 0 0% 11%;

    /* Text hierarchy */
    --text-primary: 0 0% 98%;
    --text-secondary: 0 0% 63%;
    --text-tertiary: 0 0% 44%;
    --text-disabled: 0 0% 32%;

    /* Accent muted */
    --accent-muted: 72 100% 55% / 0.12;
  }

  .dark {
    --background: 0 0% 4%;
    --foreground: 0 0% 98%;

    --card: 0 0% 8%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 11%;
    --popover-foreground: 0 0% 98%;

    --primary: 72 100% 55%;
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 11%;
    --secondary-foreground: 0 0% 98%;

    --muted: 0 0% 15%;
    --muted-foreground: 0 0% 64%;

    --accent: 72 100% 55%;
    --accent-foreground: 0 0% 0%;

    --destructive: 0 62% 30%;
    --destructive-foreground: 0 0% 98%;

    --border: 0 0% 18%;
    --input: 0 0% 18%;
    --ring: 72 100% 55%;

    --sidebar-background: 0 0% 6%;
    --sidebar-foreground: 0 0% 98%;
    --sidebar-primary: 72 100% 55%;
    --sidebar-primary-foreground: 0 0% 0%;
    --sidebar-accent: 0 0% 12%;
    --sidebar-accent-foreground: 0 0% 98%;
    --sidebar-border: 0 0% 18%;
    --sidebar-ring: 72 100% 55%;

    /* Score Tier Colors - Single Source of Truth */
    --tier-excellent: 142 76% 50%;
    --tier-good: 142 76% 42%;
    --tier-moderate: 45 93% 47%;
    --tier-weak: 24 94% 50%;
    --tier-poor: 0 84% 60%;

    /* Tier Background Colors (for badges, cards) */
    --tier-excellent-bg: 142 76% 50% / 0.15;
    --tier-good-bg: 142 76% 42% / 0.12;
    --tier-moderate-bg: 45 93% 47% / 0.12;
    --tier-weak-bg: 24 94% 50% / 0.12;
    --tier-poor-bg: 0 84% 60% / 0.12;

    /* Metric visualization colors */
    --metric-cosine: 217 91% 60%;
    --metric-chamfer: 271 91% 65%;

    /* Info state */
    --info: 217 91% 60%;
    --info-bg: 217 91% 60% / 0.12;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  html {
    @apply dark;
  }

  body {
    @apply bg-background text-foreground antialiased;
    font-feature-settings: "cv02", "cv03", "cv04", "cv11";
  }
}

/* Typography System */
@layer components {
  .text-display {
    @apply text-2xl font-semibold tracking-tight leading-tight;
    letter-spacing: -0.02em;
  }

  .text-heading {
    @apply text-base font-medium leading-normal;
    letter-spacing: -0.01em;
  }

  .text-body {
    @apply text-sm font-normal leading-relaxed;
  }

  .text-caption {
    @apply text-xs font-normal leading-normal;
  }

  .text-label {
    @apply text-[11px] font-medium uppercase tracking-wider;
    color: hsl(var(--text-tertiary));
  }
}

/* Button System */
@layer components {
  .btn-primary {
    @apply inline-flex items-center justify-center gap-2 h-9 px-6;
    @apply bg-primary text-primary-foreground;
    @apply border-none rounded-md;
    @apply text-sm font-medium;
    @apply cursor-pointer transition-all duration-150;
  }

  .btn-primary:hover:not(:disabled) {
    @apply opacity-90;
    transform: scale(1.02);
  }

  .btn-primary:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  .btn-secondary {
    @apply inline-flex items-center justify-center gap-2 h-8 px-4;
    @apply bg-transparent text-foreground;
    @apply border border-border rounded-md;
    @apply text-[13px] font-medium;
    @apply cursor-pointer transition-all duration-150;
  }

  .btn-secondary:hover:not(:disabled) {
    @apply border-[hsl(var(--border-hover))] bg-white/[0.03];
  }

  .btn-secondary:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  .icon-button {
    @apply w-8 h-8 flex items-center justify-center;
    @apply rounded-md border-none bg-transparent;
    @apply text-muted-foreground cursor-pointer;
    @apply transition-all duration-150;
  }

  .icon-button:hover {
    @apply bg-white/[0.05] text-foreground;
  }
}

/* Surface Styles */
@layer components {
  .surface {
    @apply bg-[hsl(var(--surface))];
  }

  .elevated {
    @apply bg-[hsl(var(--elevated))];
  }
}

/* Input Styles */
@layer components {
  .moonbug-input {
    @apply w-full h-9 px-3;
    @apply bg-background border border-border rounded-md;
    @apply text-foreground text-sm;
    @apply transition-all duration-150;
    @apply outline-none;
  }

  .moonbug-input:focus {
    @apply border-primary;
    box-shadow: 0 0 0 3px hsl(var(--accent-muted));
  }

  .moonbug-input::placeholder {
    @apply text-muted-foreground;
  }
}

/* Slider Styles */
@layer components {
  .moonbug-slider {
    @apply w-full h-[2px] appearance-none bg-border rounded-sm outline-none;
  }

  .moonbug-slider::-webkit-slider-thumb {
    @apply appearance-none w-3 h-3 rounded-full bg-primary cursor-pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  }

  .moonbug-slider::-webkit-slider-thumb:hover {
    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
  }
}

/* Empty State */
@layer components {
  .empty-state {
    @apply flex flex-col items-center justify-center py-16 text-center;
  }

  .empty-state svg {
    @apply text-muted-foreground/50 mb-4;
  }

  .empty-state h3 {
    @apply text-base font-medium text-foreground mb-2;
  }

  .empty-state p {
    @apply text-sm text-muted-foreground mb-4 max-w-sm;
  }
}

/* Panel Styles */
@layer components {
  .panel {
    @apply bg-[hsl(var(--surface))] border border-border rounded-lg p-6;
    @apply flex flex-col gap-4;
  }

  .panel-header {
    @apply flex items-center justify-between mb-2;
  }

  .panel-header h3 {
    @apply text-base font-medium text-foreground;
  }
}

/* Score Colors */
@layer components {
  .score-high {
    @apply text-[hsl(var(--success))];
  }

  .score-medium {
    @apply text-[hsl(var(--warning))];
  }

  .score-low {
    @apply text-destructive;
  }
}

/* Tree Styles */
@layer components {
  .tree-item {
    @apply flex items-center gap-1 py-1.5 px-2;
    @apply rounded text-[13px] text-muted-foreground;
    @apply font-mono cursor-pointer transition-all duration-150;
  }

  .tree-item:hover {
    @apply bg-white/[0.03] text-foreground;
  }

  .tree-item.active {
    @apply bg-[hsl(var(--accent-muted))] text-primary;
    @apply border-l-2 border-primary pl-[6px];
  }

  .tree-item.heading {
    @apply font-medium text-foreground;
  }
}

/* Modal Styles */
@layer components {
  .modal-backdrop {
    @apply fixed inset-0 z-50;
    @apply bg-black/70 backdrop-blur-sm;
    @apply flex items-center justify-center p-6;
  }

  .modal {
    @apply bg-[hsl(var(--elevated))] border border-border rounded-lg;
    @apply shadow-2xl w-full max-w-md max-h-[80vh];
    @apply flex flex-col;
  }

  .modal-header {
    @apply p-6 border-b border-border;
    @apply flex items-center justify-between;
  }

  .modal-header h2 {
    @apply text-lg font-semibold text-foreground;
  }

  .modal-content {
    @apply flex-1 overflow-y-auto p-4;
  }

  .modal-footer {
    @apply p-4 border-t border-border;
    @apply flex justify-end;
  }
}

/* Prose styles for markdown rendering */
.prose {
  @apply max-w-none;
}

.prose h1 {
  @apply text-2xl font-bold mt-6 mb-4 text-foreground border-b border-border pb-2;
}

.prose h2 {
  @apply text-xl font-semibold mt-5 mb-3 text-foreground;
}

.prose h3 {
  @apply text-lg font-semibold mt-4 mb-2 text-foreground;
}

.prose h4,
.prose h5,
.prose h6 {
  @apply text-base font-medium mt-3 mb-2 text-foreground;
}

.prose p {
  @apply my-3 leading-relaxed text-foreground/90;
}

.prose ul,
.prose ol {
  @apply my-3 pl-6;
}

.prose ul {
  @apply list-disc;
}

.prose ol {
  @apply list-decimal;
}

.prose li {
  @apply my-1 text-foreground/90;
}

.prose code {
  @apply bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground;
}

.prose pre {
  @apply bg-muted p-4 rounded-lg overflow-x-auto my-4;
}

.prose pre code {
  @apply bg-transparent p-0;
}

.prose blockquote {
  @apply border-l-4 border-primary/30 pl-4 italic text-muted-foreground my-4;
}

.prose a {
  @apply text-primary underline underline-offset-2 hover:text-primary/80;
}

.prose strong {
  @apply font-semibold text-foreground;
}

.prose em {
  @apply italic;
}

.prose hr {
  @apply my-6 border-border;
}

.prose table {
  @apply w-full my-4 border-collapse;
}

.prose th,
.prose td {
  @apply border border-border px-3 py-2 text-left;
}

.prose th {
  @apply bg-muted font-medium;
}

.prose img {
  @apply max-w-full h-auto rounded-lg my-4;
}

/* Tiptap Editor Styles */
.tiptap-container {
  @apply bg-background;
}

.tiptap-editor {
  @apply min-h-full outline-none;
}

.tiptap-editor.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  @apply text-muted-foreground pointer-events-none float-left h-0;
}

.tiptap-editor h1 {
  @apply text-2xl font-bold mt-6 mb-4 text-foreground border-b border-border pb-2;
}

.tiptap-editor h2 {
  @apply text-xl font-semibold mt-5 mb-3 text-foreground;
}

.tiptap-editor h3 {
  @apply text-lg font-semibold mt-4 mb-2 text-foreground;
}

.tiptap-editor h4,
.tiptap-editor h5,
.tiptap-editor h6 {
  @apply text-base font-medium mt-3 mb-2 text-foreground;
}

.tiptap-editor p {
  @apply my-3 leading-relaxed text-foreground/90;
}

.tiptap-editor ul {
  @apply my-3 pl-6 list-disc;
}

.tiptap-editor ol {
  @apply my-3 pl-6 list-decimal;
}

.tiptap-editor li {
  @apply my-1 text-foreground/90;
}

.tiptap-editor li p {
  @apply my-0;
}

.tiptap-editor code {
  @apply bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground;
}

.tiptap-editor pre {
  @apply bg-muted p-4 rounded-lg overflow-x-auto my-4;
}

.tiptap-editor pre code {
  @apply bg-transparent p-0;
}

.tiptap-editor blockquote {
  @apply border-l-4 border-primary/30 pl-4 italic text-muted-foreground my-4;
}

.tiptap-editor strong {
  @apply font-semibold text-foreground;
}

.tiptap-editor em {
  @apply italic;
}

.tiptap-editor hr {
  @apply my-6 border-border;
}

/* Focus styles for the editor */
.tiptap-editor:focus {
  @apply outline-none;
}

.ProseMirror {
  @apply min-h-[350px];
}

.ProseMirror:focus {
  @apply outline-none;
}

.ProseMirror p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  @apply text-muted-foreground pointer-events-none float-left h-0;
}

/* Global Overflow Utilities */
@layer utilities {
  /* Text overflow with line clamping */
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}

/* Ensure code blocks don't overflow */
pre {
  @apply overflow-x-auto max-w-full;
}

code {
  @apply break-words max-w-full;
}

/* Diff view overflow handling */
.diff-view {
  @apply overflow-x-auto max-w-full;
}

.diff-view pre {
  @apply whitespace-pre-wrap break-words;
}

/* Long query text */
.query-text {
  word-break: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

/* Chunk preview text */
.chunk-preview {
  @apply text-sm text-muted-foreground;
  word-break: break-word;
  overflow-wrap: break-word;
}

/* Fix for flex children overflow */
.min-w-0 {
  min-width: 0;
}

/* ============================================
   Chunk Boundary Preview Styles
   Premium, modern visual indicators for chunking
   ============================================ */

/* Boundary indicator container */
.chunk-boundary-indicator {
  @apply relative w-full py-3 select-none;
  animation: chunk-boundary-fade-in 0.25s cubic-bezier(0.16, 1, 0.3, 1);
}

/* Gradient dashed line */
.chunk-boundary-line {
  @apply absolute left-0 right-0 top-1/2 h-px;
  background: linear-gradient(
    90deg,
    transparent 0%,
    hsl(var(--primary) / 0.3) 15%,
    hsl(var(--primary) / 0.4) 50%,
    hsl(var(--primary) / 0.3) 85%,
    transparent 100%
  );
}

/* Center floating pill */
.chunk-boundary-pill {
  @apply absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2;
  @apply flex items-center gap-2 px-3 py-1.5;
  @apply bg-surface/95 backdrop-blur-md;
  @apply border border-border rounded-full;
  @apply shadow-lg shadow-black/20;
  @apply transition-all duration-200;
  box-shadow: 
    0 0 0 1px hsl(var(--primary) / 0.15),
    0 4px 12px -2px hsl(0 0% 0% / 0.25),
    0 0 20px -4px hsl(var(--primary) / 0.15);
}

.chunk-boundary-indicator:hover .chunk-boundary-pill {
  @apply border-primary/40;
  box-shadow: 
    0 0 0 1px hsl(var(--primary) / 0.3),
    0 4px 16px -2px hsl(0 0% 0% / 0.3),
    0 0 24px -4px hsl(var(--primary) / 0.25);
}

/* Animated dot indicator */
.chunk-boundary-dot {
  @apply w-2 h-2 rounded-full;
  background: hsl(var(--primary));
  box-shadow: 0 0 6px 1px hsl(var(--primary) / 0.5);
  animation: chunk-dot-pulse 2s ease-in-out infinite;
}

/* Labels */
.chunk-boundary-label {
  @apply text-xs font-medium text-foreground;
}

.chunk-boundary-tokens {
  @apply text-xs text-muted-foreground font-mono;
}

.chunk-boundary-cascade {
  @apply text-2xs text-muted-foreground/70 font-mono;
}

/* Reason badges */
.chunk-boundary-reason {
  @apply flex items-center gap-1 text-2xs uppercase tracking-wider;
  @apply px-1.5 py-0.5 rounded;
  @apply bg-muted/50 text-muted-foreground;
}

.chunk-boundary-reason.heading {
  @apply bg-primary/10 text-primary;
}

/* Margin indicators for alternating chunk colors */
.chunk-margin-indicator {
  @apply absolute left-0 top-0 bottom-0 w-1 rounded-r;
  transition: opacity 0.2s ease;
}

.chunk-margin-0 { background: hsl(var(--primary) / 0.4); }
.chunk-margin-1 { background: hsl(200 100% 50% / 0.4); }
.chunk-margin-2 { background: hsl(280 100% 60% / 0.4); }
.chunk-margin-3 { background: hsl(340 100% 55% / 0.4); }

.chunk-margin-start {
  @apply rounded-tr;
}

.chunk-margin-end {
  @apply rounded-br;
}

/* Animations */
@keyframes chunk-boundary-fade-in {
  from {
    opacity: 0;
    transform: scaleX(0.8);
  }
  to {
    opacity: 1;
    transform: scaleX(1);
  }
}

@keyframes chunk-dot-pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(0.9);
  }
}

/* Toggle button active state */
.chunk-preview-toggle-active {
  @apply bg-primary/15 text-primary border-primary/30;
  box-shadow: 0 0 8px -2px hsl(var(--primary) / 0.3);
}

/* Stats indicator in toolbar */
.chunk-stats-pill {
  @apply flex items-center gap-1.5 px-2 py-1;
  @apply text-2xs text-muted-foreground;
  @apply bg-muted/30 rounded-full;
  @apply border border-border/50;
}
